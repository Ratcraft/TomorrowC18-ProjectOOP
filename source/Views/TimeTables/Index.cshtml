@model IEnumerable<Models.TimeTable>

@{
    ViewData["Title"] = "Index";
}

<h1>Index</h1>

<p>
    <a asp-action="Create">Create New</a>
</p>
<table class="table">
    <thead>
        <tr>
            <th>
                @Html.DisplayNameFor(model => model.Start)
            </th>
            <th>
                @Html.DisplayNameFor(model => model.End)
            </th>
            <th>
                @Html.DisplayNameFor(model => model.Text)
            </th>
            <th>
                @Html.DisplayNameFor(model => model.Color)
            </th>
            <th></th>
        </tr>
    </thead>
    <tbody>
        @foreach (var item in Model)
        {
            <tr>
                <td>
                    @Html.DisplayFor(modelItem => item.Start)
                </td>
                <td>
                    @Html.DisplayFor(modelItem => item.End)
                </td>
                <td>
                    @Html.DisplayFor(modelItem => item.Text)
                </td>
                <td>
                    @Html.DisplayFor(modelItem => item.Color)
                </td>
                <td>
                    <a asp-action="Edit" asp-route-id="@item.Id">Edit</a> |
                    <a asp-action="Details" asp-route-id="@item.Id">Details</a> |
                    <a asp-action="Delete" asp-route-id="@item.Id">Delete</a>
                </td>
            </tr>
        }
    </tbody>
</table>

@section Head{
    <link type="text/css" rel="stylesheet" href="themes/calendar_g.css" />
    <link type="text/css" rel="stylesheet" href="themes/calendar_green.css" />
    <link type="text/css" rel="stylesheet" href="themes/calendar_traditional.css" />
    <link type="text/css" rel="stylesheet" href="themes/calendar_transparent.css" />
    <link type="text/css" rel="stylesheet" href="themes/calendar_white.css" />
}

<div style="display: flex">

    <div style="margin-right: 10px;">
        <div id="nav"></div>
    </div>

    <div style="flex-grow: 1;">

        <div class="space">
            Theme: <select id="theme">
                <option value="calendar_default">Default</option>
                <option value="calendar_white">White</option>
                <option value="calendar_g">Google-Like</option>
                <option value="calendar_green">Green</option>
                <option value="calendar_traditional">Traditional</option>
                <option value="calendar_transparent">Transparent</option>
            </select>
        </div>

        <div id="dp"></div>
    </div>

</div>

<script src="~/lib/daypilot/daypilot-all.min.js" asp-append-version="true"></script>
<script>
    var nav = new DayPilot.Navigator("nav");
    nav.showMonths = 3;
    nav.skipMonths = 3;
    nav.selectMode = "week";
    nav.onTimeRangeSelected = function (args) {
        dp.startDate = args.day;
        dp.update();
        loadEvents();
    };
    nav.init();

    var dp = new DayPilot.Calendar("dp");
    dp.viewType = "Week";

    dp.eventDeleteHandling = "Update";

    dp.onEventDeleted = function (args) {
        DayPilot.Http.ajax({
            url: "/api/CalendarEvents/" + args.e.id(),
            method: "DELETE",
            success: function () {
                console.log("Deleted.");
            }
        });
    };

    dp.onEventMoved = function (args) {
        DayPilot.Http.ajax({
            url: "/api/CalendarEvents/" + args.e.id(),
            method: "PUT",
            data: {
                id: args.e.id(),
                start: args.newStart,
                end: args.newEnd,
                text: args.e.text()
            },
            success: function () {
                console.log("Resized.");
            }
        });
    };

    dp.onEventResized = function (args) {
        DayPilot.Http.ajax({
            url: "/api/CalendarEvents/" + args.e.id(),
            method: "PUT",
            data: {
                id: args.e.id(),
                start: args.newStart,
                end: args.newEnd,
                text: args.e.text()
            },
            success: function () {
                console.log("Resized.");
            }
        });
    };

    // event creating
    dp.onTimeRangeSelected = function (args) {
        var name = prompt("New event name:", "Event")
        dp.clearSelection();
        if (!name) {
            return;
        }

        DayPilot.Http.ajax({
            url: "/api/CalendarEvents",
            method: "POST",
            data: {
                start: args.start,
                end: args.end,
                text: name
            },
            success: function (ajax) {
                var data = ajax.data;
                dp.events.add(new DayPilot.Event({
                    start: args.start,
                    end: args.end,
                    id: data.id,
                    text: name
                }));
                console.log("Created.");
            }
        });
    };

    dp.onEventClick = function (args) {
        alert("clicked: " + args.e.id());
    };

    dp.init();

    loadEvents();

    function loadEvents() {
        dp.events.load("/api/CalendarEvents");
    }

    var elements = {
        theme: document.querySelector("#theme")
    };

    elements.theme.addEventListener("change", function () {
        dp.theme = this.value;
        dp.update();
    });

</script>